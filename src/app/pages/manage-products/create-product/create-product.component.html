<mat-card class="cardWithShadow theme-card">
  <mat-card-header>
    <mat-card-title class="m-b-0">Створити продукт</mat-card-title>
  </mat-card-header>
  <mat-card-content class="b-t-1">
    <form [formGroup]="form" class="main-form">
      <div class="row">
        <div class="col-lg-12">
          <mat-label class="f-w-600 m-b-8 d-block">Назва товару</mat-label>
          <mat-form-field appearance="outline" class="w-100" color="primary">
            <input
              type="text"
              matInput
              placeholder="Введіть назву товару"
              formControlName="title"
            />
          </mat-form-field>
        </div>

        <div class="col-lg-12">
          <mat-label class="f-w-600 m-b-8 d-block">Ціна, грн</mat-label>
          <mat-form-field appearance="outline" class="w-100" color="primary">
            <input
              type="number"
              matInput
              placeholder="Введіть ціну"
              formControlName="price"
            />
          </mat-form-field>
        </div>

        <div class="col-lg-12">
          <mat-label class="f-w-600 m-b-8 d-block">Кількість</mat-label>
          <mat-form-field appearance="outline" class="w-100" color="primary">
            <input
              type="number"
              matInput
              placeholder="Введіть кількість"
              formControlName="stock"
            />
          </mat-form-field>
        </div>

        <div class="col-lg-12">
          <mat-label class="f-w-600 m-b-8 d-block">Статус продукту</mat-label>
          <mat-form-field appearance="outline" class="w-100">
            <mat-select formControlName="status_id">
              @for (status of (statuses$ | async) || [] | transformStatuses :
              'status_name'; track status.status_id) {
              <mat-option [value]="status.status_id">
                {{ status.status_name }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-12">
          <mat-label class="f-w-600 m-b-8 d-block"
            >Категорія продукту</mat-label
          >
          <mat-form-field appearance="outline" class="w-100">
            <mat-select formControlName="category_id">
              @for (category of (categories$ | async) || []; track
              category.category_id) {
              <mat-option [value]="category.category_id">
                {{ category.title }}
              </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>

        <div class="col-12">
          <mat-label class="f-w-600 m-b-8 d-block">Опис</mat-label>
          <mat-form-field appearance="outline" class="w-100" color="primary">
            <textarea
              formControlName="description"
              matInput
              placeholder="Опис"
              rows="4"
            ></textarea>
          </mat-form-field>
        </div>

        <div class="col-12">
          <input type="file" (change)="onFileSelect($event)" multiple />
          <div
            formArrayName="images"
            *ngFor="let image of images.controls; let i = index"
          >
            <div [formGroupName]="i">
              <img
                [src]="image.get('path')!.value"
                style="width: 100px; height: auto"
              />
              <button type="button" (click)="deleteImage(i)">Delete</button>
            </div>
          </div>

          <select formControlName="primaryImageIndex">
            <option value="" disabled *ngIf="images.length === 0" selected>
              Будь ласка, оберіть головне фото
            </option>
            <option
              *ngFor="let image of images.controls; let i = index"
              [value]="i"
            >
              {{ "Фото " + (i + 1) }}
            </option>
          </select>

          <p>Зараз вибрано фото: {{ selectedImageName | async }}</p>
        </div>

        <div class="col-12">
          <mat-label class="f-w-600 m-b-8 d-block">Атрибути товару</mat-label>
          <div
            class="d-flex align-items-center attribute-add"
            (click)="addAttribute()"
          >
            <mat-icon class="d-flex align-items-center">
              <i-tabler name="category-plus" class="icon-18 d-flex"></i-tabler>
            </mat-icon>
            <span>Додати атрибут</span>
          </div>
          <ng-container formArrayName="attributes">
            @for(attr of attributes.controls; track attr.value; let index =
            $index) {
            <div class="col-lg-6" [formGroupName]="index">
              <mat-label class="f-w-600 m-b-8 d-block">
                {{ attr.value.key }}
              </mat-label>
              <mat-form-field
                appearance="outline"
                class="w-100"
                color="primary"
              >
                <input
                  matInput
                  placeholder="your name "
                  formControlName="value"
                />
              </mat-form-field>
            </div>
            }
          </ng-container>
        </div>
      </div>

      <div class="m-t-12 d-flex justify-content-end gap-16">
        <button
          [disabled]="form.invalid"
          mat-flat-button
          color="primary"
          class="m-r-8"
          (click)="createProduct()"
        >
          Створити
        </button>
        <button mat-stroked-button color="warn">Очистити</button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
